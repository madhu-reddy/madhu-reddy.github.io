---
layout: post
title: Extend ext4 partition(/) in a Virtual machine (VMware) using "growpart"?
date: 2022-04-22 04:37:37.000000000 -04:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- Linux
- Sysadmin
tags: []
meta:
  _edit_last: '1'
  _aioseo_title: ''
  _aioseo_description: ''
  _aioseo_keywords: ''
  _aioseo_og_title: ''
  _aioseo_og_description: ''
  _aioseo_og_article_section: ''
  _aioseo_og_article_tags: ''
  _aioseo_twitter_title: ''
  _aioseo_twitter_description: ''
  _yoast_wpseo_primary_category: '34'
  ocean_gallery_link_images: 'off'
  ocean_sidebar: '0'
  ocean_second_sidebar: '0'
  ocean_disable_margins: enable
  ocean_display_top_bar: default
  ocean_display_header: default
  ocean_center_header_left_menu: '0'
  ocean_custom_header_template: '0'
  ocean_header_custom_menu: '0'
  ocean_menu_typo_font_family: '0'
  ocean_disable_title: default
  ocean_disable_heading: default
  ocean_disable_breadcrumbs: default
  ocean_display_footer_widgets: default
  ocean_display_footer_bottom: default
  ocean_custom_footer_template: '0'
  ocean_link_format_target: self
  ocean_quote_format_link: post
  _yoast_wpseo_estimated-reading-time-minutes: '3'
  _yoast_wpseo_content_score: '90'
  _thumbnail_id: '1371'
  _wtpsw_views: '272'
  rank_math_primary_category: '34'
  rank_math_news_sitemap_robots: index
  rank_math_robots: a:1:{i:0;s:5:"index";}
  rank_math_internal_links_processed: '1'
  rank_math_seo_score: '68'
  rank_math_focus_keyword: growpart,extend
  rank_math_og_content_image: a:2:{s:5:"check";s:32:"0b7b1ecf7cd0f9d8a6c730105d9787f9";s:6:"images";a:1:{i:0;i:1359;}}
  _yoast_wpseo_wordproof_timestamp: ''
permalink: "/2022/04/22/extend-ext4-partition-in-a-virtual-machine-vmware-using-growpart/"
---
<p><!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"><br />
<!-- wp:paragraph {"fontSize":"medium"} --><html><body></p>
<p class="has-medium-font-size">In this post, we'll explore extending an ext4 partition, both with and without LVM, using  "<a data-type="URL" data-id="https://manpages.ubuntu.com/manpages/xenial/en/man1/growpart.1.html" href="https://manpages.ubuntu.com/manpages/xenial/en/man1/growpart.1.html">growpart</a>".<br>Initially, we'll focus on extending the LVM root partition (/), followed by extending a non-LVM partition using '<strong>growpart</strong>'.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:heading {"style":{"typography":{"fontSize":26}}} --></p>
<h2 style="font-size:26px"><strong><span style="text-decoration: underline" class="underline"><span style="color:#ff6900" class="tadv-color">Extend LVM root partition(/) using growpart:</span></span></strong></h2>
<p><!-- /wp:heading --></p>
<p><!-- wp:paragraph {"fontSize":"medium"} --></p>
<p class="has-medium-font-size">1) From the VM, navigate to 'Edit settings' and adjust the hard disk size according to your needs. In my case, I increased it from 120GB to 140GB.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"id":1359,"sizeSlug":"large","linkDestination":"none"} --></p>
<figure class="wp-block-image size-large"><img src="{{site.baseurl}}/assets/2022/04/image-2.png" alt="" class="wp-image-1359"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph {"fontSize":"medium"} --></p>
<p class="has-medium-font-size">2) Now, execute the following command to rescan the block device, updating the kernel with the latest disk size information:<br><code>echo '1' &gt; /sys/class/scsi_disk/32\:0\:0\:0/device/rescan</code> –&gt; (where “32\:0\:0\:0” is the SCSI disk ID for my disk, which might differ for yours; verify the correct value inside the directory).</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph {"fontSize":"medium"} --></p>
<p class="has-medium-font-size">3) When you use the command '<strong><mark style="background-color:rgba(0, 0, 0, 0)" class="has-inline-color has-luminous-vivid-orange-color">fdisk -l</mark></strong>' observe that the '<strong>/dev/sda5</strong>' LVM partition is created within an '<strong>Extended</strong>' partition. Consequently, we need to extend the '<strong>Extended</strong>' partition (/dev/sda2) first, and then proceed to extend the actual LVM partition (/dev/sda5).</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:code --></p>
<pre class="wp-block-code"><code>root@madhu-testvm:~# fdisk -l
Disk /dev/sda: 150.3 GB, 150323855360 bytes
/dev/sda1   *        2048      499711      248832   83  Linux
/dev/sda2          499712   251658239   125579264    5  <span style="color:#ff6900" class="tadv-color">Extended</span>
/dev/sda5          501760   251658239   125578240   8e  <span style="color:#ff6900" class="tadv-color">Linux LVM</span>
</code></pre>
<p><!-- /wp:code --></p>
<p><!-- wp:paragraph --></p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph {"fontSize":"medium"} --></p>
<p class="has-medium-font-size">4) First extending the "Extended" partition as shown in the below command<br><span style="color:#ff6900" class="tadv-color">growpart /dev/sda 2</span></p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"id":1360,"sizeSlug":"large","linkDestination":"none"} --></p>
<figure class="wp-block-image size-large"><img src="{{site.baseurl}}/assets/2022/04/image-3.png" alt="" class="wp-image-1360"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph {"fontSize":"medium"} --></p>
<p class="has-medium-font-size">5) Now after extending the "Extended" partition, we can go ahead and extend the actual LVM partition with the following command,<br><span style="color:#ff6900" class="tadv-color">growpart /dev/sda 5</span></p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"id":1361,"sizeSlug":"large","linkDestination":"none"} --></p>
<figure class="wp-block-image size-large"><img src="{{site.baseurl}}/assets/2022/04/image-4.png" alt="" class="wp-image-1361"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph {"fontSize":"medium"} --></p>
<p class="has-medium-font-size">6) partprobe /dev/sda # <strong>To request the kernel to re-read the partition table</strong>.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph {"fontSize":"medium"} --></p>
<p class="has-medium-font-size">7) pvresize /dev/sda5  # <strong>To resize the physical volume</strong> <strong>to the maximum size available</strong>. (the new size can be verified using "<span style="color:#ff6900" class="tadv-color"><strong>pvs</strong></span>" or can also be verified using "<span style="color:#ff6900" class="tadv-color"><strong>vgs</strong></span>" command)</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph {"fontSize":"medium"} --></p>
<p class="has-medium-font-size">8) lvextend -l +100%FREE /dev/madhu-vg/root   #<strong> to extend the LVM to maximum size available.</strong></p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph {"fontSize":"medium"} --></p>
<p class="has-medium-font-size">9) resize2fs /dev/madhu-vg/root    # <strong>This is to enlarge the file system (Ex: ext4 in my case) on the LVM</strong>.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph {"style":{"typography":{"fontSize":28}}} --></p>
<p style="font-size:28px"><strong><span style="text-decoration: underline" class="underline"><span style="color:#ff6900" class="tadv-color">Expanding normal (Non-LVM)  partition using growpart:</span></span></strong></p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph {"fontSize":"medium"} --></p>
<p class="has-medium-font-size">1) From the VM, navigate to “Edit settings” and increase the size of the hard disk as per the requirement. In my case, it was 130GB, so I have increased it to 150GB.<br></p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"id":1363,"sizeSlug":"large","linkDestination":"none"} --></p>
<figure class="wp-block-image size-large"><img src="{{site.baseurl}}/assets/2022/04/image-5.png" alt="" class="wp-image-1363"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph {"fontSize":"medium"} --></p>
<p class="has-medium-font-size">2) Now, execute the following command to rescan the block device, so that the kernel has the latest disk size information.<br><code>echo '1' &gt; /sys/class/scsi_disk/32\:0\:1\:0/device/rescan</code> –&gt; (where “32\:0\:0\:0” is the SCSI disk ID).</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph {"fontSize":"medium"} --></p>
<p class="has-medium-font-size">3) Identify the partition we need to expand (using fdisk or lsblk), in my case, it's '<strong>/dev/sdb1</strong>'.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:code --></p>
<pre class="wp-block-code"><code>root@madhu-server~# fdisk -l | grep sdb
Disk /dev/sdb: 161.1 GB, 161061273600 bytes
/dev/sdb1            2048   314568764   157283358+  83  Linux
</code></pre>
<p><!-- /wp:code --></p>
<p><!-- wp:paragraph {"fontSize":"medium"} --></p>
<p class="has-medium-font-size">4) Now extend the partition (/dev/sdb1) with growpart.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"id":1365,"sizeSlug":"large","linkDestination":"none"} --></p>
<figure class="wp-block-image size-large"><img src="{{site.baseurl}}/assets/2022/04/image-7.png" alt="" class="wp-image-1365"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph {"fontSize":"medium"} --></p>
<p class="has-medium-font-size">5) partprobe /dev/sdb # <strong>To request the kernel to re-read the partition table</strong>.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph {"fontSize":"medium"} --></p>
<p class="has-medium-font-size">6) Now the final step is to extend the file system on the partition.<br>     <strong><span style="color:#ff6900" class="tadv-color">resize2fs /dev/sdb1</span></strong><br><br></p>
<p><!-- /wp:paragraph --><br />
</body></html></p>
