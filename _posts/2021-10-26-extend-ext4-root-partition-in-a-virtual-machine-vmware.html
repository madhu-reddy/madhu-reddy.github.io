---
categories: ['Linux', 'Administration']
layout: post
title: Extend ext4 root partition(/) in a Virtual machine (VMware) using "parted"?
date: 2021-10-26 13:36:34.000000000 -04:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
- Linux
tags: []
meta:
  _edit_last: '1'
  ocean_gallery_link_images: 'off'
  ocean_sidebar: '0'
  ocean_second_sidebar: '0'
  ocean_disable_margins: enable
  ocean_display_top_bar: default
  ocean_display_header: default
  ocean_center_header_left_menu: '0'
  ocean_custom_header_template: '0'
  ocean_header_custom_menu: '0'
  ocean_menu_typo_font_family: '0'
  ocean_disable_title: default
  ocean_disable_heading: default
  ocean_disable_breadcrumbs: default
  ocean_display_footer_widgets: default
  ocean_display_footer_bottom: default
  ocean_custom_footer_template: '0'
  ocean_link_format_target: self
  ocean_quote_format_link: post
  _yoast_wpseo_estimated-reading-time-minutes: '3'
  _yoast_wpseo_content_score: '90'
  _yoast_wpseo_primary_category: '2'
  _thumbnail_id: '918'
  _wtpsw_views: '186'
  _aioseo_title: ''
  _aioseo_description: ''
  _aioseo_keywords: ''
  _aioseo_og_title: ''
  _aioseo_og_description: ''
  _aioseo_og_article_section: ''
  _aioseo_og_article_tags: ''
  _aioseo_twitter_title: ''
  _aioseo_twitter_description: ''
  rank_math_primary_category: '2'
  rank_math_news_sitemap_robots: index
  rank_math_robots: a:1:{i:0;s:5:"index";}
  rank_math_og_content_image: a:2:{s:5:"check";s:32:"2e1c34aedb3b89a9b9d977712e93b64d";s:6:"images";a:2:{i:0;i:894;i:1;i:910;}}
  rank_math_internal_links_processed: '1'
  _yoast_wpseo_wordproof_timestamp: ''
permalink: "/2021/10/26/extend-ext4-root-partition-in-a-virtual-machine-vmware/"
---
<p><!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"><br />
<!-- wp:paragraph {"fontSize":"medium"} --><html><body></p>
<p class="has-medium-font-size">This post will guide you through extending the ext4 partition (/) with and without LVM using parted.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph {"fontSize":"medium"} --></p>
<p class="has-medium-font-size">While there are other methods for extending the root partition, such as fdisk and growpart, we will focus only on these two approaches in this discussion.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph {"fontSize":"medium"} --></p>
<p class="has-medium-font-size">First, we will explore extending the LVM root partition (/), followed by extending the non-LVM ext4 root partition (/) using parted.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:tadv/classic-paragraph --></p>
<p>                            .</p>
<p><!-- /wp:tadv/classic-paragraph --></p>
<p><!-- wp:heading {"level":1} --></p>
<h1><span style="text-decoration: underline" class="underline"><span style="color:#ff6900" class="tadv-color">Extending LVM root partition(/) using parted: </span></span></h1>
<p><!-- /wp:heading --></p>
<p><!-- wp:paragraph {"fontSize":"medium"} --></p>
<p class="has-medium-font-size">1) From the VM, go to "Edit settings" and increase the size of the hard disk as per the requirement.<br>In my case, it was 100, so I have increased it to 120.<br><img class="wp-image-894" style="width: 700px;" src="{{site.baseurl}}/assets/2021/10/disk-increase.png" alt=""></p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:tadv/classic-paragraph /--></p>
<p><!-- wp:paragraph {"fontSize":"medium"} --></p>
<p class="has-medium-font-size">2) Run the following command to rescan the block device, so that the kernel has the latest disk size information.<br><code>echo '1' &gt; /sys/class/scsi_disk/32\:0\:0\:0/device/rescan</code>      --&gt; (where "32\:0\:0\:0" is the SCSI disk ID).<br><br>3) Open a terminal window and enter the command <code>parted</code>. Within the parted utility, type the command <code>print</code> to display the current partition table. Locate the partition you want to expand, which in this case is <code>/dev/sda5</code>.<br>Note the current size of the partition, which is 107 GB in your example.<br><br>In our case, we need to expand the LVM partition (<code>/dev/sda5</code>) from 107 GB to 129 GB.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:code --></p>
<pre class="wp-block-code"><code>root@madhu-testvm# parted
GNU Parted 2.3
Using /dev/sda
Welcome to GNU Parted! Type 'help' to view a list of commands.
(parted) print                                                            
Model: VMware Virtual disk (scsi)
<span style="color:#ff6900" class="tadv-color">Disk /dev/sda: 129GB</span>                                            <strong><span style="color:#ff6900" class="tadv-color"> # New size</span></strong>
Sector size (logical/physical): 512B/512B
Partition Table: msdos

Number  Start   End    Size   Type      File system  Flags
 1      1049kB  256MB  255MB  primary   ext2         boot
 2      256MB   107GB  107GB  extended
 5      257MB   107GB  107GB  logical                lvm

(parted)                                               </code></pre>
<p><!-- /wp:code --></p>
<p><!-- wp:paragraph {"fontSize":"medium"} --></p>
<p class="has-medium-font-size">4) In the example above, we are using a logical partition within an extended partition. This requires expanding both partitions sequentially. First, extend the "extended partition" save the changes, and then extend the "logical partition".</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p><img class="wp-image-910" style="width: 600px;" src="{{site.baseurl}}/assets/2021/10/parted-1.png" alt=""></p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph {"fontSize":"medium"} --></p>
<p class="has-medium-font-size"><br>Next, execute the following commands to update the kernel and enable it to recognize the updated partition table. This will also allow the Logical Volume to be resized to reflect the new disk size.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph {"fontSize":"medium"} --></p>
<p class="has-medium-font-size">5) partprobe /dev/sda                              # <strong>To request the kernel to re-read the partition table</strong>.<br>6) pvresize /dev/sda5<br>7) lvextend -l +100%FREE /dev/madhu-vg/root<br>8)resize2fs /dev/madhu-vg/root</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>                                                     .</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:heading {"level":1} --></p>
<h1><span style="text-decoration: underline" class="underline"><span style="color:#ff6900" class="tadv-color">Extending normal root partition(/) using parted:</span></span></h1>
<p><!-- /wp:heading --></p>
<p><!-- wp:paragraph {"fontSize":"medium"} --></p>
<p class="has-medium-font-size">1) From the VM, go to "Edit settings" and increase the size of the hard disk as per the requirement.<br>In my case, it was 20, so I have increased it to 35.<br><br><img class="wp-image-907" style="width: 700px;" src="{{site.baseurl}}/assets/2021/10/increase-disk.png" alt=""></p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph {"fontSize":"medium"} --></p>
<p class="has-medium-font-size">2) Run the following command to rescan the block device, so that the kernel has the latest disk size information.<br><code>echo '1' &gt; /sys/class/scsi_disk/32\:0\:0\:0/device/rescan</code> --&gt; (where "32\:0\:0\:0" is the scsi disk ID).<br><br>3) Open a terminal window and enter the command <code>parted</code>. Within the parted utility, type the command <code>print</code> to display the current partition table. Locate the partition you want to expand, which in this case is the root partition (<code>/dev/sda1</code>).<br>Note the current size of the partition, which is 20 GB in your example.<br>Now, use the command <code>resizepart 1 37GB</code> to resize the non-LVM root partition from 20 GB to 37 GB.<br>Save the changes using the command <code>print</code> and then <code>quit</code>.<br><img class="wp-image-911" style="width: 600px;" src="{{site.baseurl}}/assets/2021/10/increase-disk1-1.png" alt=""></p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph {"fontSize":"medium"} --></p>
<p class="has-medium-font-size">Subsequently, execute the following commands to instruct the kernel to reread the partition table and subsequently resize the filesystem using resize2fs.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph {"fontSize":"medium"} --></p>
<p class="has-medium-font-size">4) partprobe /dev/sda<br>5) resize2fs /dev/sda1</p>
<p><!-- /wp:paragraph --><br />
</body></html></p>
