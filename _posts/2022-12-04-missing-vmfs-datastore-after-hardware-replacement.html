---
categories: ['VMware', 'Storage']
layout: post
title: Troubleshooting Missing VMFS Datastore After RAID Controller Card Replacement
date: 2022-12-04 00:24:15.000000000 -05:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
- VMware
tags: []
meta:
  _edit_last: '1'
  _aioseo_title: ''
  _aioseo_description: ''
  _aioseo_keywords: ''
  _aioseo_og_title: ''
  _aioseo_og_description: ''
  _aioseo_og_article_section: ''
  _aioseo_og_article_tags: ''
  _aioseo_twitter_title: ''
  _aioseo_twitter_description: ''
  _yoast_wpseo_primary_category: '14'
  ocean_gallery_link_images: 'off'
  ocean_sidebar: '0'
  ocean_second_sidebar: '0'
  ocean_disable_margins: enable
  ocean_display_top_bar: default
  ocean_display_header: default
  ocean_center_header_left_menu: '0'
  ocean_custom_header_template: '0'
  ocean_header_custom_menu: '0'
  ocean_menu_typo_font_family: '0'
  ocean_disable_title: default
  ocean_disable_heading: default
  ocean_disable_breadcrumbs: default
  ocean_display_footer_widgets: default
  ocean_display_footer_bottom: default
  ocean_custom_footer_template: '0'
  ocean_link_format_target: self
  ocean_quote_format_link: post
  _yoast_wpseo_estimated-reading-time-minutes: '3'
  _yoast_wpseo_content_score: '60'
  _wp_old_date: '2022-12-02'
  _wtpsw_views: '76'
  _thumbnail_id: '1685'
  rank_math_primary_category: '14'
  rank_math_news_sitemap_robots: index
  rank_math_robots: a:1:{i:0;s:5:"index";}
  rank_math_seo_score: '70'
  rank_math_focus_keyword: missing vmfs datastore
  rank_math_internal_links_processed: '1'
  rank_math_og_content_image: a:2:{s:5:"check";s:32:"d891a42312408d6255b0c3de468ce1f7";s:6:"images";a:2:{i:0;i:1666;i:1;i:1668;}}
  rank_math_ca_keyword: a:2:{s:7:"keyword";s:22:"missing vmfs datastore";s:7:"country";s:3:"all";}
  _yoast_wpseo_wordproof_timestamp: ''
permalink: "/2022/12/04/missing-vmfs-datastore-after-hardware-replacement/"
---
<p><!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"><br />
<!-- wp:paragraph {"fontSize":"medium"} --><html><body></p>
<p class="has-medium-font-size">Are you experiencing a missing VMFS datastore after replacing the RAID Controller Card in your server. Although all the disk's foreign configurations have been successfully imported, the datastore is still missing.<br><br>While the storage device (Disk/LUN) is detected and visible in the vCenter, the VMFS volume/datastore associated with the storage device remains unmounted and invisible in the vCenter. Consequently, all my VMs are displaying as inaccessible.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"align":"left","id":1666,"sizeSlug":"large","linkDestination":"none"} --></p>
<figure class="wp-block-image alignleft size-large"><img src="{{site.baseurl}}/assets/2022/12/image-1.png" alt="" class="wp-image-1666"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph {"fontSize":"medium"} --></p>
<p class="has-medium-font-size"><br><br><br><br><br><br>After troubleshooting, I discovered that the issue stemmed from the ESXi host identifying the LUN as a <code>Snapshot LUN</code>. According to VMware, this problem may arise <mark style="background-color:rgba(0, 0, 0, 0)" class="has-inline-color has-luminous-vivid-orange-color">after replacing SAN hardware, performing firmware upgrades, SAN replication, DR tests, or certain HBA firmware upgrades</mark>.<br><br></p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph {"style":{"typography":{"fontSize":"25px"}}} --></p>
<p style="font-size:25px"><br><strong><span style="text-decoration: underline" class="underline"><span style="color:#cf2e2e" class="tadv-color">What is a Snapshot LUN?</span></span></strong></p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph {"fontSize":"medium"} --></p>
<p class="has-medium-font-size">A Snapshot LUN is essentially a copy of the original LUN. When a VMFS volume is created on a Disk/LUN, it is assigned a Universally Unique Identifier (UUID). This UUID, a crucial part of VMFS metadata, is determined by certain properties of the Disk/LUN and is stored on the LUN itself.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph {"fontSize":"medium"} --></p>
<p class="has-medium-font-size">After changing the RAID controller, the properties of the LUN could undergo internal modifications. Subsequently, when the ESXi discovers the Disk/LUN, it compares the VMFS metadata with the LUN properties. <code>If a mismatch is detected, ESXi identifies the LUN as a snapshot.</code> To confirm this, check the 'vmkernel.log' file<br><img width="624" height="61" src="{{site.baseurl}}/assets/2022/12/OR-P0NmLzUEyHLwMmkacyyCliP-Dfyl7XgEuTHi2SRPiGLUducFwd8NVX-Oiny6HgpGx3Fiw1utLZdlB0VWsNFW-sOeFk5UKRpFahE6U_L0NuKQAl4PaI6lkL5BkpTLEv22I6R55fxZm3aOs5bPN1WvWTObl-q45pOWePfZsANkHod0YDQOs4ThrnSgQ"></p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:heading {"style":{"typography":{"fontSize":"25px"}}} --></p>
<h2 style="font-size:25px"><strong><span style="text-decoration: underline" class="underline"><span style="color:#cf2e2e" class="tadv-color">Resolution for Missing VMFS Datastore is force mounting</span></span></strong></h2>
<p><!-- /wp:heading --></p>
<p><!-- wp:paragraph {"fontSize":"medium"} --></p>
<p class="has-medium-font-size">1) From the ESXi SSH shell, execute the following command to list the LUNs detected as snapshot LUNs<br><code><strong>esxcli storage vmfs snapshot list</strong></code></p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"align":"left","id":1668,"sizeSlug":"large","linkDestination":"none"} --></p>
<figure class="wp-block-image alignleft size-large"><img src="{{site.baseurl}}/assets/2022/12/image-2.png" alt="" class="wp-image-1668"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph {"fontSize":"medium"} --></p>
<p class="has-medium-font-size"><br><br><br><br><br><br>The above provided screenshot illustrates that the VMFS datastore (TEST_DATASTORE) exists on the snapshot LUN.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph {"fontSize":"medium"} --></p>
<p class="has-medium-font-size">2) In our case,  '<strong>Can mount</strong>' is set to <strong>true</strong>, so you can forcibly mount the VMFS datastore using its UUID or name, as demonstrated below<br><code><strong>esxcli storage vmfs snapshot mount -l label|-u uuid</strong></code><br><br><strong><span style="text-decoration: underline" class="underline">For example:</span></strong><br><code><strong>esxcli storage vmfs snapshot mount -l "TEST_DATASTORE"<br>esxcli storage vmfs snapshot mount -u "9532244d-a124e5c7-39c6-635678884144"</strong></code><br><br><br>The command above mounts the VMFS datastore without changing its existing signature (<code>no change in VMFS UUID</code>). <br>However, there is a drawback to this approach. If in the future we need to increase the VMFS datastore size, it won't be possible. <code>'Force mounting' </code>is a temporary step for immediate access. Later, to allow for size expansion, all VMs must be migrated or stopped, enabling the assignment of a new signature (<code>resulting in a change in VMFS UUID</code>) to the VMFS datastore.<br><br></p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph {"style":{"typography":{"fontSize":"27px"}}} --></p>
<p style="font-size:27px"><br><strong><span style="text-decoration: underline" class="underline"><span style="color:#cf2e2e" class="tadv-color">Assigning a new signature to the VMFS Datastore</span></span></strong></p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph {"fontSize":"medium"} --></p>
<p class="has-medium-font-size"><strong><span style="text-decoration: underline" class="underline">NOTE:</span></strong><br>Before proceeding with the resignature, ensure that all VMs are either stopped or migrated off this datastore, and unmount it from the ESXi Host.<br><br><strong><span style="text-decoration: underline" class="underline">Syntax:</span></strong><br><code><strong>esxcli storage vmfs snapshot resignature -l label|-u uuid</strong></code><br><br><strong><span style="text-decoration: underline" class="underline">For example:</span></strong><br><code><strong>esxcli storage vmfs snapshot resignature -l "<strong>TEST_DATASTORE</strong>"<br>esxcli storage vmfs snapshot resignature -u "<strong>9532244d-a124e5c7-39c6-635678884144</strong>"</strong></code></p>
<p><!-- /wp:paragraph --><br />
</body></html></p>
