---
categories: ['Linux', 'SSH']
layout: post
title: How to perform ssh agent forwarding for git clone using ssh authentication?
date: 2021-11-07 09:49:15.000000000 -05:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
- Linux
tags:
- ssh agent forwarding
meta:
  _edit_last: '1'
  ocean_gallery_link_images: 'off'
  ocean_sidebar: '0'
  ocean_second_sidebar: '0'
  ocean_disable_margins: enable
  ocean_display_top_bar: default
  ocean_display_header: default
  ocean_center_header_left_menu: '0'
  ocean_custom_header_template: '0'
  ocean_header_custom_menu: '0'
  ocean_menu_typo_font_family: '0'
  ocean_disable_title: default
  ocean_disable_heading: default
  ocean_disable_breadcrumbs: default
  ocean_display_footer_widgets: default
  ocean_display_footer_bottom: default
  ocean_custom_footer_template: '0'
  ocean_link_format_target: self
  ocean_quote_format_link: post
  _yoast_wpseo_content_score: '30'
  _yoast_wpseo_estimated-reading-time-minutes: '2'
  _yoast_wpseo_primary_category: '2'
  _thumbnail_id: '949'
  _wtpsw_views: '225'
  _aioseo_title: ''
  _aioseo_description: ''
  _aioseo_keywords: ''
  _aioseo_og_title: ''
  _aioseo_og_description: ''
  _aioseo_og_article_section: ''
  _aioseo_og_article_tags: ''
  _aioseo_twitter_title: ''
  _aioseo_twitter_description: ''
  rank_math_primary_category: '2'
  rank_math_news_sitemap_robots: index
  rank_math_robots: a:1:{i:0;s:5:"index";}
  rank_math_internal_links_processed: '1'
  _yoast_wpseo_wordproof_timestamp: ''
permalink: "/2021/11/07/how-to-perform-ssh-agent-forwarding-for-git-clone-using-ssh-authentication/"
---
<p><!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"><br />
<!-- wp:paragraph {"fontSize":"medium"} --><html><body></p>
<p class="has-medium-font-size">Suppose we want to clone a GitHub repository using SSH authentication. In this case, we need to ensure that the corresponding private key is available on the server where we intend to perform the Git clone.<br><br>One option, which is not recommended, is to manually copy the private key to the server and delete it once the clone is complete. However, this method can be problematic if we need to clone the repository to multiple servers and we forget to delete the key after each clone.<br><br>SSH agent forwarding provides a more secure and efficient solution for this task.<br><br><strong><span style="text-decoration: underline" class="underline">1) Start the ssh-agent and then add the SSH private key to the ssh-agent</span></strong><br><code><mark class="kt-highlight">ssh-agent bash<br>ssh-add /home/user/id_rsa</mark></code></p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph {"fontSize":"medium"} --></p>
<p class="has-medium-font-size"><strong>2)</strong> <strong><span style="text-decoration: underline" class="underline">Enabling the ssh agent forwarding</span></strong></p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph {"fontSize":"medium"} --></p>
<p class="has-medium-font-size">In your client's <strong>ssh_config</strong> file, add the following line:<br><mark class="kt-highlight">Host *<br>  ForwardAgent yes</mark><br>The "*" wildcard indicates that agent forwarding should be enabled for all hosts.<br><br>                    <strong>   <span style="color:#ff6900" class="tadv-color"> (OR)</span></strong><br><br>Alternatively, instead of modifying the client's <strong>ssh_config</strong> file, you can directly enable ssh-agent forwarding using the "-A" option with the "ssh" command as shown below:<br><mark class="kt-highlight">ssh -A madhu@remoteserver</mark></p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph {"fontSize":"medium"} --></p>
<p class="has-medium-font-size">By following either method, you can successfully clone the Git repository on the remote server using SSH authentication.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph {"backgroundColor":"luminous-vivid-amber","fontSize":"medium"} --></p>
<p class="has-luminous-vivid-amber-background-color has-background has-medium-font-size"><br>madhu@remoteserver:~$ git clone git@github.com:madhu-reddy/python-projects.git<br>Cloning into 'python-projects'...<br>remote: Enumerating objects: 65, done.<br>remote: Counting objects: 100% (65/65), done.<br>remote: Compressing objects: 100% (58/58), done.<br>remote: Total 65 (delta 13), reused 42 (delta 2), pack-reused 0<br>Receiving objects: 100% (65/65), 13.52 KiB | 0 bytes/s, done.<br>Resolving deltas: 100% (13/13), done.<br>Checking connectivity... done.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph {"fontSize":"medium"} --></p>
<p class="has-medium-font-size"><strong><span style="text-decoration: underline" class="underline">In simpler terms, here's how this authentication works:</span></strong><br><br>When the user attempts to clone the GitHub repository from within the server, GitHub sends a randomly generated encrypted message (encrypted using the public key stored on GitHub's servers) to the server to verify its possession of the corresponding private key.<br><br>The server, lacking the private key locally, utilizes the environment variable (SSH_AUTH_SOCK) to forward GitHub's challenge to the local client system, which holds the actual private key.<br><br>The local client system deciphers the random encrypted message sent by GitHub using its stored private key and prepares the answer. It then sends the response back to the server, which relays it to GitHub.<br><br>Upon receiving the decrypted message, GitHub verifies that it matches the original message sent to the server. If the verification is successful, authentication is deemed successful, and GitHub grants the server permission to clone the repository.<br><br>I found <a href="https://www.howtogeek.com/devops/what-is-ssh-agent-forwarding-and-how-do-you-use-it/">this nice article</a>, which explains clearly with real-world example,</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:code --></p>
<pre class="wp-block-code"><code>It works like this: you ask your remote server to pull some code from Github, and Github says “who are you?” to the server. Usually the server would consult its own id_rsa files to answer, but instead it will forward the question to your local machine. Your local machine answers the question and sends the response (which does not include your private key) to the server, which forwards it back to Github. Github doesn’t care that your local machine answered the question, it just sees that it’s been answered, and lets you connect.</code></pre>
<p><!-- /wp:code --><br />
</body></html></p>
